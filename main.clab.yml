name: ospf-mpls-backbone

mgmt:
  network: ospf-mgmt
  ipv4-subnet: 172.20.21.0/24

topology:
  nodes:
    # ============================================
    # BACKBONE ROUTERS (OSPF Area 0)
    # ============================================
    R2:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.12
      binds:
        - configs/R2/daemons:/etc/frr/daemons
        - configs/R2/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    R5:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.15
      binds:
        - configs/R5/daemons:/etc/frr/daemons
        - configs/R5/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    R6:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.16
      binds:
        - configs/R6/daemons:/etc/frr/daemons
        - configs/R6/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    R7:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.17
      binds:
        - configs/R7/daemons:/etc/frr/daemons
        - configs/R7/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    # ============================================
    # AREA 1 ROUTERS (Site-A/B Access)
    # ============================================
    R3:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.13
      binds:
        - configs/R3/daemons:/etc/frr/daemons
        - configs/R3/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    R4:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.14
      binds:
        - configs/R4/daemons:/etc/frr/daemons
        - configs/R4/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    # ============================================
    # AREA 2 ROUTERS (Site-C/D Access)
    # ============================================
    R1:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.11
      binds:
        - configs/R1/daemons:/etc/frr/daemons
        - configs/R1/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    R8:
      kind: linux
      image: frrouting/frr:v8.4.0
      mgmt-ipv4: 172.20.21.18
      binds:
        - configs/R8/daemons:/etc/frr/daemons
        - configs/R8/frr.conf:/etc/frr/frr.conf
      exec:
        - touch /etc/frr/vtysh.conf
        - chown -R frr:frr /etc/frr
        - /usr/lib/frr/frrinit.sh start

    # ============================================
    # CLIENT SITES (End Users)
    # ============================================
    Site-A:
      kind: linux
      image: alpine:latest
      mgmt-ipv4: 172.20.21.101
      exec:
        - ip addr add 10.1.0.10/24 dev eth1
        - ip route del default
        - ip route add default via 10.1.0.1

    Site-B:
      kind: linux
      image: alpine:latest
      mgmt-ipv4: 172.20.21.102
      exec:
        - ip addr add 10.2.0.10/24 dev eth1
        - ip route del default
        - ip route add default via 10.2.0.1

    Site-C:
      kind: linux
      image: alpine:latest
      mgmt-ipv4: 172.20.21.103
      exec:
        - ip addr add 10.3.0.10/24 dev eth1
        - ip route del default
        - ip route add default via 10.3.0.1

    Site-D:
      kind: linux
      image: alpine:latest
      mgmt-ipv4: 172.20.21.104
      exec:
        - ip addr add 10.4.0.10/24 dev eth1
        - ip route del default
        - ip route add default via 10.4.0.1

  links:
    # ============================================
    # BACKBONE MESH (OSPF Area 0)
    # ============================================
    - endpoints: ["R2:eth1", "R5:eth1"]
    - endpoints: ["R2:eth2", "R6:eth1"]
    - endpoints: ["R2:eth3", "R7:eth1"]
    - endpoints: ["R5:eth2", "R6:eth2"]
    - endpoints: ["R5:eth3", "R7:eth2"]
    - endpoints: ["R6:eth3", "R7:eth3"]

    # ============================================
    # AREA 1 CONNECTIONS
    # ============================================
    - endpoints: ["R3:eth1", "R2:eth4"]
    - endpoints: ["R3:eth2", "R4:eth1"]
    - endpoints: ["R4:eth2", "R5:eth4"]
    - endpoints: ["R3:eth3", "Site-A:eth1"]
    - endpoints: ["R3:eth4", "Site-B:eth1"]

    # ============================================
    # AREA 2 CONNECTIONS
    # ============================================
    - endpoints: ["R1:eth1", "R2:eth5"]
    - endpoints: ["R1:eth2", "R8:eth1"]
    - endpoints: ["R8:eth2", "R7:eth4"]
    - endpoints: ["R1:eth3", "Site-D:eth1"]
    - endpoints: ["R8:eth3", "Site-C:eth1"]
